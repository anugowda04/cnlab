//CRC

import java.util.Scanner;

public class crc {

	private static final int poly = 0x1021;
	
	public static String calculateCRC (String data) {
	
		int crc = 0xFFFF;
		for (char c : data.toCharArray()) {
			int byteValue = (int)c;
			crc ^= (byteValue << 8)&0xFFFF;
			for (int i=0;i<8;i++) {
				if((crc & 0x8000)!=0)
					crc = (crc << 1)^poly;
				else
					crc <<= 1;
			}
		}
		return Integer.toString(crc);
	}
	
	public static boolean validateCRC (String recievedData, String recievedCRC) {
	
		int crc = Integer.parseInt(recievedCRC);
		for (char c : recievedData.toCharArray()) {
			int byteValue = (int)c;
			crc ^= (byteValue << 8) & 0xFFFF;
			for (int i=0;i<8;i++){
				if((crc & 0x8000)!= 0) 
					crc = (crc<<1)^poly;
				else
					crc <<= 1;
				crc &= 0xFFFF;
			}
		}
		return crc==0;
	}
	
	public static void main (String[] args) {
		
		Scanner sc = new Scanner(System.in);
		
		//Sender side
		System.out.println("Enter the data for CRC Calculation:");
		String inputData = sc.nextLine().trim();
		String crcChecksum = calculateCRC(inputData);
		String dataWithCRC = inputData + crcChecksum;
		System.out.println("Transmitting data with CRC : "+dataWithCRC);
		
		//Reciever side
		System.out.println("Enter the recieved data(message+CRC):");
		String recievedData = sc.nextLine().trim();
		String recievedMessage = recievedData.substring(0,recievedData.length()-5);
		String recievedString = recievedData.substring(recievedData.length()-5);
		boolean isValid = validateCRC(recievedMessage,recievedString);
		if (isValid)
			System.out.println("CRC Check : Data is intact. Recieved message : "+recievedMessage);
		else
			System.out.println("CRC CHeck : Data is corrupted. Discarding the message.");
		sc.close();
	}

}
